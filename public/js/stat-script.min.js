$(document).ready(function(){function t(t){var a=document.getElementById("myCanvas"),e=a.getContext("2d");e.clearRect(0,0,a.width,a.height),e.lineWidth=1,e.lineJoin="round";var i=0,n=0,r=0,c=["rgba(255,0,0,0.3)","rgba(255,51,0,0.3)","rgba(255,102,0,0.3)","rgba(255,153,0,0.3)","rgba(255,204,0,0.3)","rgba(255,255,0,0.3)","rgba(204,255,0,0.3)","rgba(153,255,0,0.3)","rgba(102,255,0,0.3)","rgba(51,255,0,0.3)","rgba(0,255,0,0.3)"];t.forEach(function(t){t.forEach(function(t){var s=a.width/t.w,g=a.height/t.h,o=t.x*s,l=t.y*g,h=t.time,p=Math.floor((h-r)/10)-1;p>10&&(p=10),e.beginPath(),e.moveTo(o,l),e.lineTo(i,n),e.strokeStyle=c[p],e.stroke(),e.closePath();var d=t.click?7:1;e.fillStyle="rgba(0,0,0,0.1)",e.beginPath(),e.arc(o,l,d,0,2*Math.PI,!0),e.fill(),e.closePath(),i=o,n=l,r=h})})}var a=io.connect(),e=[];a.on("pageview",function(t){t.url&&$("#pageviews").prepend('<tr><td><a class="draw-canvas"data-page="'+t.url+'" data-ip="'+t.ip+'">'+t.url+"</td><td> "+t.ip+"</td><td> "+t.time+"</td></tr>"),$("#connections").text(t.connections)}),$("#pageviews").on("click",".draw-canvas",function(){var i=$(this).data("ip"),n=$(this).data("page");a.emit("pagebyiprequest",{ip:i,page:n},function(a){e=JSON.parse(a),t(e)}),$("#current-graph").html('<b class="text-success">'+n+'</b> views from <b class="text-info">'+i+"</b>")}),$("#page-btns ul li a").on("click",function(){var i=$("#host").val(),n=$(this).data("page"),r=$(this).data("action");"display"===r?(a.emit("pagerequest",{host:i,page:n},function(a){e=JSON.parse(a),t(e)}),$("#current-graph").html('<b class="text-success">'+n+"</b> aggregate")):a.emit("aggregatepage",{host:i,page:n},function(t){$("#agg-success").text(t)})})});